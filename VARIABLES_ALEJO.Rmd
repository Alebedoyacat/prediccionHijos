---
title: "VARIABLES_ALEJO"
author: "Alejandro Bedoya Cataño"
date: "25/3/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(dplyr)
library(ggplot2)
```

## Carga de las bases de datos

Las variables que han sido asignadas son las siguientes:

* **P6040:** Edad BD: Características y composición del hogar
* **P8587:** Nivel educativo más alto alcanzado BD: Educación
* **P6435:** Tipo de trabajo BD: Fuerza trabajo
* **P5661S5:** Invasión de espacio público BD: Datos vivienda
* **P6240:** Ocupación semana anterior BD: Fuerza trabajo
* **P8586:** ¿Estudia actualmente? BD: Educación 

**NOTA:** De entrada se ha decidio descartar la variable **P6240** en tanto tras consideración posterior, se observó que responde a una característica demasiado específica e individual. 

```{r}
#setwd()  #Pa que definan la ruta de su directorio
educacion <- read.csv("Educación.csv",sep = ";", dec = ",")
fuerza_trabajo <- read.csv("Fuerza de trabajo.csv", sep = ";", dec = ",")
compo_hogar <- read.csv("Caracteristicas y composicion del hogar.csv", sep=";", dec=",")
datos_vivienda <- read.csv('Datos de la vivienda.csv', sep = ";", dec = ",")
uso_energetico <- read.csv('Uso de energéticos del hogar.csv', sep=";", dec = ",")
```

```{r}
colnames(compo_hogar)[1] <- "DIRECTORIO"
colnames(educacion)[1] <- "DIRECTORIO"
colnames(fuerza_trabajo)[1] <- "DIRECTORIO"
colnames(datos_vivienda)[1] <- "DIRECTORIO"
colnames(uso_energetico)[1] <- "DIRECTORIO"
compo_hogar$DIRECTORIO <- as.factor(compo_hogar$DIRECTORIO)
educacion$DIRECTORIO <- as.factor(educacion$DIRECTORIO)
fuerza_trabajo$DIRECTORIO <- as.factor(fuerza_trabajo$DIRECTORIO)
datos_vivienda$DIRECTORIO <- as.factor(datos_vivienda$DIRECTORIO)
uso_energetico$DIRECTORIO <- as.factor(uso_energetico$DIRECTORIO)
```

# Número de hijos 

```{r}
#Se seleccionan las columnas directorio y P6051
directorio_P6051 <- compo_hogar %>% select(DIRECTORIO,P6051)
#Se cuentan el numero de hijos por hogar
hijos_hogar <- directorio_P6051 %>% filter(P6051 == 3) %>% count(DIRECTORIO)
colnames(hijos_hogar)[2] <- "Hijos"
nrow(hijos_hogar)
```
Véanse ahora algunas seccions que corresponden a la base de datos considerada en adición con el número de hijos, y el listado de variables que de cada una de esas base se analizó. 


## Características del hogar + número de hijos

Al construir la intersección de información entre características del hogar e hijos_hogar, se debe abordar el estudio de la variable  **P6040:** Edad. En particular resultará de interés la edad de la persona cabeza de familia con relación al número de hijos. 

```{r}
compo_hogar %>% 
  filter(P6051==1) -> cabezas_de_familia

compo_hijos <- merge(x = cabezas_de_familia, y = hijos_hogar, by = 'DIRECTORIO', all=TRUE)
compo_hijos$Hijos[is.na(compo_hijos$Hijos)] <- 0
summary(cabezas_de_familia$P6040)
```

Véase el siguiente histograma de frecuencias para la edad de las cabezas de familia.

```{r}
h1 <- ggplot(compo_hijos, aes(x=P6040))
h1 <- h1 + geom_histogram(binwidth = 1, col='black', fill='blue', alpha=0.4)
h1 <- h1 + xlab("EDAD")+ylab("FRECUENCIA")
h1 <- h1 + ggtitle("HISTOGRAMA DE FRECUENCIAS PARA EDAD")+theme_bw()
h1
```

Y ahora la relación de esas edades con el número de hijos

```{r}
cor(compo_hijos$P6040, compo_hijos$Hijos)
```


```{r}
p8<-ggplot(compo_hijos, aes(x=P6040, y=Hijos))
p8 <- p8 + geom_point(col='black', fill='blue', shape=21, alpha=0.5)
p8<-p8+xlab("Edad")+ylab("Cantidad de hijos")
p8<-p8+ggtitle("Edad vs cantidad de hijos")+theme_bw()
p8
```

La cantidad de hijos en hogares donde la cabeza de hogar tiene entre 25 y 50 suele tener cierta estabilida como "meseta" y además es la región en donde se presentan los valores máximos. Además, con una correlación de -0.23, se puede evidenciar que a mayor edad, menor cantidad de hijos.

```{r}
mod_edad <- lm(Hijos ~ P6040, data=compo_hijos)
summary(mod_edad)
```

Se observa además que en la explicación de la cantidad de hijos, la variable edad presenta una alta significancia (considerar que en este caso no se cumplen los supuestos del modelo de regresión; sólo se busca evidencia de significancia)



## Educacion + número de hijos

```{r}
hijos_del_cabeza <- merge(cabezas_de_familia, hijos_hogar, by = 'DIRECTORIO', all = TRUE)
#hijos_del_cabeza$Hijos[is.na(hijos_del_cabeza)] <- 0
edu_hijos <- merge(x = hijos_hogar, y = educacion, by = 'DIRECTORIO',all = TRUE)
edu_hijos$Hijos[is.na(edu_hijos$Hijos)] <- 0
edu_hijos$Hijos[edu_hijos$ORDEN!=1 & edu_hijos$ORDEN!=2] <- 0 
```
### Variable P8587: Máximo nivel académico

En particular podría resultar de interés el máximo nivel académico alcanzado por el cabeza de familia. Veanse las frecuencias para los niveles de la variable

```{r}
edu_hijos$P8587 <- as.factor(edu_hijos$P8587)
summary(edu_hijos$P8587)
```


```{r message=FALSE, warning=FALSE}
P2 <- ggplot(subset(edu_hijos, !is.na(P8587)), aes(x=P8587))
P2 <- P2 + geom_bar(width = 0.8, fill="blue", alpha=0.4)
P2 <- P2 + scale_x_discrete("Nivel educativo maximo") + scale_y_continuous("FRECUENCIA")
P2 <- P2 + labs(title = " Frecuencias para nivel educativo máximo")+theme_bw()
P2
```


```{r include=FALSE}
theme_elegante <- function(base_size = 10,
                           base_family = "Raleway"
)
{
        color.background = "#FFFFFF" # Chart Background
        color.grid.major = "#D9D9D9" # Chart Gridlines
        color.axis.text = "#666666" # 
        color.axis.title = "#666666" # 
        color.title = "#666666"
        color.subtitle = "#666666"
        strip.background.color = '#9999CC'
        
        ret <-
                theme_bw(base_size=base_size) +
                
                # Set the entire chart region to a light gray color
                theme(panel.background=element_rect(fill=color.background, color=color.background)) +
                theme(plot.background=element_rect(fill=color.background, color=color.background)) +
                theme(panel.border=element_rect(color=color.background)) +
                
                # Format the grid
                theme(panel.grid.major=element_line(color=color.grid.major,size=.55, linetype="dotted")) +
                theme(panel.grid.minor=element_line(color=color.grid.major,size=.55, linetype="dotted")) +
                theme(axis.ticks=element_blank()) +
                
                # Format the legend, but hide by default
                theme(legend.position="none") +
                theme(legend.background = element_rect(fill=color.background)) +
                theme(legend.text = element_text(size=base_size-3,color=color.axis.title, family = base_family)) +
                
                theme(strip.text.x = element_text(size=base_size,color=color.background, family = base_family)) +
                theme(strip.text.y = element_text(size=base_size,color=color.background, family = base_family)) +
                #theme(strip.background = element_rect(fill=strip.background.color, linetype="blank")) +
                theme(strip.background = element_rect(fill = "grey70", colour = NA)) +
                # theme(panel.border= element_rect(fill = NA, colour = "grey70", size = rel(1)))+
                # Set title and axis labels, and format these and tick marks
                theme(plot.title=element_text(color=color.title, 
                                              size=20, 
                                              vjust=1.25, 
                                              family=base_family, 
                                              hjust = 0.5
                )) +
                
                theme(plot.subtitle=element_text(color=color.subtitle, size=base_size+2, family = base_family,  hjust = 0.5))  +
                
                theme(axis.text.x=element_text(size=base_size,color=color.axis.text, family = base_family)) +
                theme(axis.text.y=element_text(size=base_size,color=color.axis.text, family = base_family)) +
                theme(text=element_text(size=base_size, color=color.axis.text, family = base_family)) +
                
                theme(axis.title.x=element_text(size=base_size+2,color=color.axis.title, vjust=0, family = base_family)) +
                theme(axis.title.y=element_text(size=base_size+2,color=color.axis.title, vjust=1.25, family = base_family)) +
                theme(plot.caption=element_text(size=base_size-2,color=color.axis.title, vjust=1.25, family = base_family)) +
                
                # Legend  
                theme(legend.text=element_text(size=base_size,color=color.axis.text, family = base_family)) +
                theme(legend.title=element_text(size=base_size,color=color.axis.text, family = base_family)) +
                theme(legend.key=element_rect(colour = color.background, fill = color.background)) +
                theme(legend.position="bottom", 
                      legend.box = "horizontal", 
                      legend.title = element_blank(),
                      legend.key.width = unit(.75, "cm"),
                      legend.key.height = unit(.75, "cm"),
                      legend.spacing.x = unit(.25, 'cm'),
                      legend.spacing.y = unit(.25, 'cm'),
                      legend.margin = margin(t=0, r=0, b=0, l=0, unit="cm")) +
                
                # Plot margins
                theme(plot.margin = unit(c(.5, .5, .5, .5), "cm"))
        
        ret
}
```


```{r message=FALSE, warning=FALSE}
P1 <- ggplot(edu_hijos, aes(x=P8587, y=Hijos))+
  geom_boxplot(color='blue',fill='blue',alpha=0.2,notch = F,notchwidth = 0.8,
               outlier.colour = 'red',outlier.fill = 'red',outlier.size = 3)+
  labs(title = 'Nivel educativo máximo alcanzado',subtitle = ' ',caption = ' ',
       x = 'Nivel educativo máximo alcanzado', y='Numero de hijos',color=NULL)+
  theme_elegante()+
  stat_summary(fun=mean,geom='point',shape=21,size=2,color='black',fill='black')
P1
```

### Variable P8586: ¿Estudia actualmente?

Esta variable sólo cuenta con dos niveles 

* 1: Sí
* 2: No

Véanse las frecuencias para los niveles de la variable

```{r}
edu_hijos$P8586 <- as.factor(edu_hijos$P8586)
summary(edu_hijos$P8586)
```

```{r}
P2 <- ggplot(subset(edu_hijos, !is.na(P8586)), aes(x=P8586))
P2 <- P2 + geom_bar(width = 0.8, fill=c("blue","red"), alpha=0.4)
P2 <- P2 + scale_x_discrete("¿Estudia? Si vs No") + scale_y_continuous("FRECUENCIA")
P2 <- P2 + labs(title = " Frecuencias para situación educativa")+theme_bw()
P2
```

Ahora los boxplots para relacionar con la cantidad de hijos

```{r message=FALSE, warning=FALSE}
P1 <- ggplot(edu_hijos, aes(x=P8586, y=Hijos))+
  geom_boxplot(color='blue',fill='blue',alpha=0.2,notch = F,notchwidth = 0.8,
               outlier.colour = 'red',outlier.fill = 'red',outlier.size = 3)+
  labs(title = 'Situación académica: ¿Estudia? - todas las personas',subtitle = ' ',caption = ' ',
       x = 'Situación académica', y='Numero de hijos',color=NULL)+
  theme_elegante()+
  stat_summary(fun=mean,geom='point',shape=21,size=2,color='black',fill='black')
P1
```
Veamoslo ahora únicamente para los cabezas de familia

```{r}
edu_hijos_cabeza <- merge(hijos_del_cabeza, educacion, by = 'DIRECTORIO', all=TRUE)
edu_hijos_cabeza$P8586 <- as.factor(edu_hijos_cabeza$P8586)
summary(edu_hijos_cabeza$P8586)

```

```{r}
P2 <- ggplot(subset(edu_hijos_cabeza, !is.na(P8586)), aes(x=P8586))
P2 <- P2 + geom_bar(width = 0.8, fill=c("blue","red"), alpha=0.4)
P2 <- P2 + scale_x_discrete("Situación académica") + scale_y_continuous("FRECUENCIA")
P2 <- P2 + labs(title = " Frecuencias situación académica - cabezas de hogar")+theme_bw()
P2
```


```{r message=FALSE, warning=FALSE}
P1 <- ggplot(edu_hijos_cabeza, aes(x=P8586, y=Hijos))+
  geom_boxplot(color='blue',fill='blue',alpha=0.2,notch = F,notchwidth = 0.8,
               outlier.colour = 'red',outlier.fill = 'red',outlier.size = 3)+
  labs(title = 'Situación académica: ¿Estudia? - cabezas de hogar',subtitle = ' ',caption = ' ',
       x = 'Situación académica', y='Numero de hijos',color=NULL)+
  theme_elegante()+
  stat_summary(fun=mean,geom='point',shape=21,size=2,color='black',fill='black')
P1
```

## Fuerza de trabajo + número de hijos

```{r}
futra_hijos <- merge(x = hijos_hogar, y = fuerza_trabajo, by = 'DIRECTORIO',all = TRUE)
futra_hijos$Hijos[is.na(futra_hijos$Hijos)] <- 0
futra_hijos$Hijos[futra_hijos$ORDEN!=1] <- 0 
```

En particular el interés sobre esta base de datos se centrará en 2 variables:

* P6435: Tipo de trabajo
* P6240 Ocupación semana anterior (Descartada)

### Tipo de trabajo:

* 1: Obrero empresa particular
* 2: Obrero empresa gubernamental
* 3: Empleado doméstico
* 4: Profesional independiente  
* 5: Trabajador independiente o por cuenta propia
* 6: Patrón o empleador
* 7: Trabajador de finca, tierra o parcela propia en arriendo
* 8: Trabajador sin remuneración
* 9: Ayudante sin remuneración
* 10: Jornalero de peón

```{r}
futra_hijos$P6435 <- as.factor(futra_hijos$P6435)
summary(futra_hijos$P6435)
```

```{r}
P2 <- ggplot(subset(futra_hijos, !is.na(P6435)), aes(x=P6435))
P2 <- P2 + geom_bar(width = 0.8, fill="blue", alpha=0.4)
P2 <- P2 + scale_x_discrete("Tipo de trabajo") + scale_y_continuous("FRECUENCIA")
P2 <- P2 + labs(title = " Frecuencias para tipos de trabajo")+theme_bw()
P2
```

```{r message=FALSE, warning=FALSE}
P1 <- ggplot(futra_hijos, aes(x=P6435, y=Hijos))+
  geom_boxplot(color='blue',fill='blue',alpha=0.2,notch = F,notchwidth = 0.8,
               outlier.colour = 'red',outlier.fill = 'red',outlier.size = 3)+
  labs(title = 'Tipo de trabajo - todas las personas',subtitle = ' ',caption = ' ',
       x = 'Tipo de trabajo', y='Numero de hijos',color=NULL)+
  theme_elegante()+
  stat_summary(fun=mean,geom='point',shape=21,size=2,color='black',fill='black')
P1
```

## Datos vivienda + número de hijos 

```{r}
vivi_hijos <- merge(x = hijos_hogar, y = datos_vivienda, by = 'DIRECTORIO',all = TRUE)
vivi_hijos$Hijos[is.na(vivi_hijos$Hijos)] <- 0
#vivi_hijos$Hijos[vivi_hijos$ORDEN!=1 & vivi_hijos$ORDEN!=2] <- 0 
```

El interés en esta base de datos se centrará en una única variable: \textbf{P5661S5} Invasión de espacio público, que tiene los siguientes niveles que responden a la pregunta "¿En los últimos 12 meses con qué frecuencia se han presentado problemas de invasión al espacio público?

* 1: Nunca
* 2: Algunas veces
* 3: Muchas veces
* 4 Siempre

```{r}
vivi_hijos$P5661S5 <- as.factor(vivi_hijos$P5661S5)
summary(vivi_hijos$P5661S5)
```
Véase el gráfico de frecuencias

```{r}
P2 <- ggplot(subset(vivi_hijos, !is.na(P5661S5)), aes(x=P5661S5))
P2 <- P2 + geom_bar(width = 0.8, fill="blue", alpha=0.4)
P2 <- P2 + scale_x_discrete("Frecuencia de problemas") + scale_y_continuous("FRECUENCIA")
P2 <- P2 + labs(title = " Frecuencia de problemas - Invasión espacio publico")+theme_bw()
P2
```


```{r message=FALSE, warning=FALSE}
vivi_hijos$P5661S5 <- as.factor(vivi_hijos$P5661S5)
P1 <- ggplot(subset(vivi_hijos, vivi_hijos$ORDEN==1), aes(x=P5661S5, y=Hijos))+
  geom_boxplot(color='blue',fill='blue',alpha=0.2,notch = F,notchwidth = 0.8,
               outlier.colour = 'red',outlier.fill = 'red',outlier.size = 3)+
  labs(title = 'Problemas invasión espacio público',subtitle = ' ',caption = ' ',
       x = 'Frecuencia de los problemas', y='Numero de hijos',color=NULL)+
  theme_elegante()+
  stat_summary(fun=mean,geom='point',shape=21,size=2,color='black',fill='black')
P1
```



```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
P1 <- ggplot(vivi_hijos, aes(x=P5661S5, y=Hijos))+
  geom_boxplot(color='blue',fill='blue',alpha=0.2,notch = F,notchwidth = 0.8,
               outlier.colour = 'red',outlier.fill = 'red',outlier.size = 3)+
  labs(title = 'Problemas invasión espacio publico',subtitle = ' ',caption = ' ',
       x = 'Frecuencia con que se presentan', y='Numero de hijos',color=NULL)+
  theme_elegante()+
  stat_summary(fun=mean,geom='point',shape=21,size=2,color='black',fill='black')
P1
```

# Base de datos adicional: Uso de energéticos en el hogar

Respecto a esta base de datos las variables que resultarán de particular interés son las situientes:
  
  * P5018: ¿Cuánto pagaro en la ultima factura de energía
  * P8524S1: Cantidad de meses al que corresponde el pago de esa factura
  
## P5018: Consumo de energía ultima factura 

Variable de tipo numérica que contiene la información a la pregunta: ¿Cuánto pagaron EL MES PASADO o la última vez por la electricidad consumida?

```{r}
energia_hijos <- merge(x = uso_energetico, y = hijos_hogar, by = 'DIRECTORIO', all=TRUE)
energia_hijos$Hijos[is.na(energia_hijos$Hijos)] <- 0
summary(energia_hijos$P5018)
```

Algunos gráficos de utilidad 

```{r}
p8<-ggplot(energia_hijos, aes(x=P5018, y=Hijos))
p8 <- p8 + geom_point(col='black', fill='blue', shape=21, alpha=0.5)
#p8 <- p8 + geom_abline(slope = 0.0000007, intercept = 1.231092)
p8<-p8+xlab("Pago en energia")+ylab("Cantidad de hijos")
p8<-p8+ggtitle("Pago en energía vs cantidad de hijos")+theme_bw()
p8
```

```{r}
s_energia_hijos <- subset(energia_hijos, !is.na(energia_hijos$P5018))
cor(s_energia_hijos$P5018, s_energia_hijos$Hijos)
```
Se observa una correlación positiva demasiado leve, indicio de que quizá no vaya a ser de mayor utilidad en la explicación de la variable de respuesta. 

```{r}
mod_energia <- lm(Hijos ~ P5018, data=s_energia_hijos)
summary(mod_energia)
```

La variabilidad explicada es demasiado baja, sumado a la evidencia de correlación da indicios para descartar. 


## P8524S1: Cantidad de meses al que corresponde el pago de esa factura

En tanto se considera descartar la variable anterior, no tiene sentido considerar esta, puesto que sólo tiene utilidad bajo el aporte significativo de la variable anterior. 






