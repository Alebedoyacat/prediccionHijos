---
title: "Análisis de Relación Entre Variables Asignadas"
author: "Juan Fernando Patiño Castro"
date: "22/3/2021"
output: html_document
---
#Descripción General
En este caso las based de datos por analizar son: 

- Fuerza de Trabajo
- Características y Composición del Hogar
- Educación
- Datos de la Vivienda

De la base de datos asignada "Atención integral de los niños y niñas menores de 5 años" no se destacan variables puesto que todas ellas se realizan a un menor de edad.

Llamado de Librerías
```{r}
library(dplyr)
library(ggplot2)
library(knitr)
```

# Obtención de Datos

## Descarga de Bases de Datos
En caso de que no exista, se crea la carpeta "Datos" en donde se alojarán las bases de datos
```{r}
if (!dir.exists("./Datos")) {
  dir.create("./Datos")
}
```

Se descargan las bases de datos. Se descarga el zip completo y de el se extrae únicamente el archivo csv correspondiente
```{r}
#Función para descargar bases de datos
descargar_bd <- function (url_origen, ruta_destino, nombre_archivo) {
  
  #Se descarga el archivo zip que contiene los conjuntos de datos 
  download.file(url = url_origen, destfile = ruta_destino, method = "curl")
  
  #Se extrae el .csv que contiene los datos
  unzip(zipfile =  ruta_destino, files = nombre_archivo, exdir = "./Datos")
  
  #Se elimina el zip
  unlink(ruta_destino)
}

```

```{r}
#Almacenando las url de las bases de datos
url_Caracteristicas <- "http://microdatos.dane.gov.co/index.php/catalog/678/download/13707"
url_fuerza <- "http://microdatos.dane.gov.co/index.php/catalog/678/download/13711"
url_educacion <- "http://microdatos.dane.gov.co/index.php/catalog/678/download/13710"
url_vivienda <- "http://microdatos.dane.gov.co/index.php/catalog/678/download/13705"

#Se crean las rutas de destino del archivo
ruta_destino_caracteristicas <- "./Datos/Caracteristicas.zip"
ruta_destino_fuerza <- "./Datos/Fuerza de trabajo.zip"
ruta_destino_educacion <- "./Datos/Educacion.zip"
ruta_destino_vivienda <- "./Datos/Vivienda.zip"

#Se crea el nombre del archivo a extraer de cada zip
nombre_caracteristicas <- "Caracteristicas y composicion del hogar.csv"
nombre_trabajo <- "Fuerza de trabajo.csv"
nombre_educacion <- "Educaci¢n.csv"
nombre_vivienda <- "Datos de la vivienda.csv"

#Se descarga la base de datos usando la función creada previamente
descargar_bd(url_Caracteristicas, ruta_destino_caracteristicas, nombre_caracteristicas)
descargar_bd(url_fuerza, ruta_destino_fuerza, nombre_trabajo)
descargar_bd(url_educacion, ruta_destino_educacion, nombre_educacion)
descargar_bd(url_vivienda, ruta_destino_vivienda, nombre_vivienda)

#Borrando variables que no se usan
rm(url_Caracteristicas)
rm(url_fuerza)
rm(url_educacion)
rm(url_vivienda)
rm(ruta_destino_caracteristicas)
rm(ruta_destino_fuerza)
rm(ruta_destino_educacion)
rm(ruta_destino_vivienda)
```
## Lectura de archivos csv
```{r}
#Lectura de la composición del hogar
csv_caracteristicas <- read.csv2(file = paste("./Datos/", nombre_caracteristicas, sep=""), sep = ";", dec = ",")
csv_trabajo <- read.csv2(file = paste("./Datos/", nombre_trabajo, sep=""), sep = ";", dec = ",")
csv_educacion <- read.csv2(file = paste("./Datos/", nombre_educacion, sep=""), sep = ";", dec = ",")
csv_vivienda <- read.csv2(file = paste("./Datos/", nombre_vivienda, sep=""), sep = ";", dec = ",")
```

Corrigiendo el nombre de la primera columna para todos los csv
```{r}
#Se cambia el nombre de la primera columna
colnames(csv_caracteristicas)[1] <- "Directorio"
colnames(csv_trabajo)[1] <- "Directorio"
colnames(csv_educacion)[1] <- "Directorio"
colnames(csv_vivienda)[1] <- "Directorio"

#Nombre de las columnas
print("Características y Composición del Hogar")
colnames(csv_caracteristicas); cat("\n")

print("Fuerza de Trabajo")
colnames(csv_trabajo); cat("\n")

print("Educación")
colnames(csv_educacion); cat("\n")

print("Datos de la Vivienda")
colnames(csv_vivienda)
```
# Estudio de las Variables Asignadas

En este caso las variables asignadas son:

- P8634     (Fuerza Trabajo)
- P2059     (Características y Composición del Hogar)
- P5502     (Características y Composición del Hogar)
- P6218     (Educación)
- P8520S1   (Datos de la Vivienda)
- P1070     (Datos de la Vivienda)

## Preprocesamiento
Primero se encuentra el número de hijos por hogar usando la base de datos "Características y Composición del Hogar"
```{r}

#Se cuentan el numero de hijos por hogar
hijos_hogar <- csv_caracteristicas %>% select(Directorio, P6051) %>% filter(P6051 == 3) %>% count(Directorio)

#Se renombra la columna 2
colnames(hijos_hogar)[2] <- "Hijos"

head(hijos_hogar)
```

Ahora se asignan los hijos a cada jefe de hogar
```{r}
#Se filtra el parentezco dejando solo a los jefes de hogar
jefe_hogar <- csv_caracteristicas %>% filter(P6051 == 1)

#Se asocian los hijos a cada jefe de hogar
hijos_jefe <- merge(jefe_hogar, hijos_hogar, by = "Directorio", all = TRUE)

#A los jefe de hogar sin hijos se les establecen cero hijos
hijos_jefe$Hijos[is.na(hijos_jefe$Hijos)] <- 0

#Se eliminan las variables no utilizadas
rm(jefe_hogar)
```

## Variable P8634 (Fuerza Trabajo)

Los encuestados responden a la siguente pregunta: **Fundamentalmente, donde realiza usted su trabajo principal:**

1. Local fijo, oficina, fabrica, etc.
2. En la vivienda que habita
3. En otras viviendas
4. En quiosco o caseta
5. En un vehículo (taxi, carro, bus, lancha, barco)
6. Puerta a puerta
7. Sitio al descubierto en la calle (ambulante o estacionario)
8. En el campo o área rural, mar, o rio
9. En una obra de construcción
10. En una mina o cantera

```{r}
auxiliar_datos <- csv_trabajo %>% filter(ORDEN == 1) %>% select(Directorio, P8634)

auxiliar_merge <- merge(hijos_jefe, csv_trabajo, by = "Directorio", all = TRUE)

ggplot(subset(auxiliar_merge, !is.na(P8634)), aes(x = P8634, y = Hijos)) + geom_point() + scale_x_continuous(breaks=c(1,2,3,4,5,6,7,8,9,10))
```

## Variable P2059 (Características y Composición del Hogar)

Los encuestados responden a la siguente pregunta: **¿Usted considera que alguna vez fue campesino(a)?**

1. Si
2. No
3. No informa

```{r}
#Se hace una corrección porque aparecen N/A y en vez de 9 un 3
hijos_jefe$P2059[is.na(hijos_jefe$P2059)] <- 3
hijos_jefe$P2059[hijos_jefe$P2059 == 9] <- 3

tapply(hijos_jefe$Hijos, hijos_jefe$P2059, summary)
```

```{r}
ggplot(hijos_jefe, aes(x = as.factor(P2059), y = Hijos)) +  geom_boxplot() + xlab("P2059")
```

## Variable P5502 (Características y Composición del Hogar)

Los encuestados responden a la siguente pregunta: **Actualmente…**

1. No está casado(a) y vive en pareja hace menos de dos años
2. No está casado(a) y vive en pareja hace dos años o más
3. Está viudo(a)
4. Está separado(a) o divorciado(a)
5. Está soltero(a)
6. Está casado(a)

```{r}
tapply(hijos_jefe$Hijos, hijos_jefe$P5502, summary)
```
```{r}
table(hijos_jefe[c("Hijos", "P5502")])
```
```{r}
ggplot(hijos_jefe, aes(x = as.factor(P5502), y = Hijos)) +
    geom_boxplot() +
    xlab("P5502")
```

## Variable P6218 (Educación)

Los encuestados responden a la siguente pregunta: **Cuál es la razón principal para qué_no estudie?**

1. Considera que no está en edad escolar
2. Considera que ya terminó
3. Falta de dinero o costos educativos elevados
4. Debe encargarse de los oficios del hogar (cuidado de niño(a)s y de otras personas del hogar:ancianos(ADULTOS MAYORES), personas discapacitadas, etc.)
5. Por embarazo
6. Por inseguridad o malos tratos en el establecimiento educativo; inseguridad en el entorno del centro educativo o del lugar de residencia
7. Falta de cupos
8. No existe centro educativo cercano o el establecimiento asignado es muy lejano
9. Necesita trabajar
10. No le gusta o no le interesa el estudio
11. Por enfermedad
12. Necesita educación especial
13. Tuvieron que abandonar el lugar de residencia habitual
14. Sus padres o la persona encargada de su cuidado no lo considera importante
15. Por situaciones académicas (bajos resultados en el periodo académico, repetición de cursos)
16. Otra razón, ¿cuál?

```{r}
auxiliar_datos <- csv_educacion %>% filter(ORDEN == 1) %>% select(Directorio, P6218)

auxiliar_merge <- merge(hijos_jefe, csv_educacion, by = "Directorio", all = TRUE)

ggplot(subset(auxiliar_merge, !is.na(P6218)), aes(x = P6218, y = Hijos)) + geom_point() + scale_x_continuous(breaks=c(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16))
```

```{r}
#hijos_jefe %>% select(Hijos, P415) %>% filter(!is.na(P415)) %>% cor()
```

## Variable P8520S1 (Datos de la Vivienda)

Los encuestados responden a la siguente pregunta: **¿Con cuáles de los siguientes servicios públicos, privados o comunales cuenta la vivienda? 1. Energía eléctrica**

1. Sí
2. No

```{r}
auxiliar_datos <- csv_vivienda %>% filter(ORDEN == 1) %>% select(Directorio, P8520S1)

auxiliar_merge <- merge(hijos_jefe, csv_vivienda, by = "Directorio", all = TRUE)

ggplot(subset(auxiliar_merge, !is.na(P8520S1)), aes(x = P8520S1, y = Hijos)) + geom_point() + scale_x_continuous(breaks=c(1,2))
```

## Variable P1070 (Datos de la Vivienda)

Los encuestados responden a la siguente pregunta: **Tipo de vivienda**

1. Casa
2. Apartamento
3. Cuarto(s)
4. Vivienda tradicional indigena
5. Otro (carpa, contenedor, vagón, embarcación, cueva, refugio natural, etc)

```{r}
#auxiliar_datos <- csv_vivienda %>% filter(ORDEN == 1) %>% select(Directorio, P8520S1)

#auxiliar_merge <- merge(hijos_jefe, csv_vivienda, by = "Directorio", all = TRUE)

ggplot(subset(auxiliar_merge, !is.na(P1070)), aes(x = P1070, y = Hijos)) + geom_point() + scale_x_continuous(breaks=c(1,2,3,4,5))
```